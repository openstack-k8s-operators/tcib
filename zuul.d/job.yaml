---
- job:
    name: tcib-openstack-meta-content-provider-master
    parent: openstack-meta-content-provider
    vars:
      cifmw_repo_setup_branch: master
      cifmw_bop_dlrn_baseurl: "https://trunk.rdoproject.org/centos9-master"
      cifmw_bop_openstack_release: master
      cifmw_set_openstack_containers_namespace: podified-master-centos9
      cifmw_update_containers_org: "podified-master-centos9"
      cifmw_build_containers_registry_namespace: podified-master-centos9
      cifmw_install_yamls_vars_patch_registry_url:
        DATAPLANE_REGISTRY_URL: quay.io/podified-master-centos9

- job:
    name: tcib-podified-multinode-edpm-deployment-crc-master
    parent: podified-multinode-edpm-deployment-crc
    dependencies:
      - tcib-openstack-meta-content-provider-master
    irrelevant-files: &irrelevant_files
      - HACKING.rst
      - AUTHORS
      - .gitignore
      - ^README.md$
      - .*/*.md
      - .ci-operator.yaml
      - .pre-commit-config.yaml
      - .pylintrc
      - .stestr.conf
      - .github/workflows
      - .coveragerc
      - LICENSE
      - OWNERS*
    vars: &edpm_vars
      cifmw_repo_setup_branch: master
      cifmw_bop_dlrn_baseurl: "https://trunk.rdoproject.org/centos9-master"
      cifmw_bop_openstack_release: master
      cifmw_set_openstack_containers_namespace: podified-master-centos9
      cifmw_update_containers_org: podified-master-centos9
      cifmw_build_containers_registry_namespace: podified-master-centos9
      cifmw_install_yamls_vars_patch_registry_url:
        DATAPLANE_REGISTRY_URL: quay.io/podified-master-centos9
      cifmw_run_test_role: test_operator
      cifmw_test_operator_stages:
        - name: tempest
          type: tempest
      cifmw_test_operator_tempest_registry: "{{ content_provider_os_registry_url | split('/') | first }}"
      cifmw_test_operator_tempest_namespace: "{{ content_provider_os_registry_url | split('/') | last }}"
      cifmw_test_operator_tempest_image_tag: "{{ content_provider_dlrn_md5_hash }}"
      cifmw_test_operator_tempest_include_list: |
        tempest.scenario.test_network_basic_ops.TestNetworkBasicOps

- job:
    name: tcib-crc-podified-edpm-baremetal-master
    parent: cifmw-crc-podified-edpm-baremetal
    dependencies:
      - tcib-openstack-meta-content-provider-master
    irrelevant-files: *irrelevant_files
    vars: *edpm_vars

- job:
    name: tcib-podified-multinode-edpm-deployment-crc-tobiko-master
    parent: tcib-podified-multinode-edpm-deployment-crc-master
    files:
      - ^container-images/tcib/base/tobiko/
      - ^zuul.d/
    vars:
      cifmw_test_operator_stages:
        - name: tobiko
          type: tobiko
      cifmw_test_operator_tobiko_registry: "{{ cifmw_test_operator_tempest_registry }}"
      cifmw_test_operator_tobiko_namespace: "{{ cifmw_test_operator_tempest_namespace }}"
      cifmw_test_operator_tobiko_image_tag: "{{ content_provider_dlrn_md5_hash }}"
      cifmw_test_operator_tobiko_workflow:
        - stepName: sanity
          testenv: sanity
          numProcesses: 2
        - stepName: scenario-nova
          testenv: nova
          numProcesses: 1
      # enabling heat is needed for some tobiko tests
      cifmw_edpm_prepare_kustomizations:
        - apiVersion: kustomize.config.k8s.io/v1beta1
          kind: Kustomization
          namespace: openstack
          patches:
          - patch: |-
              apiVersion: core.openstack.org/v1beta1
              kind: OpenStackControlPlane
              metadata:
                name: unused
              spec:
                heat:
                  enabled: true
            target:
              kind: OpenStackControlPlane
